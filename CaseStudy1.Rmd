---
title: "Case Study 1"
author: "Karen, Samuel, Laurence"
date: "February 8, 2019"
output: 
        html_document:
        keep_md: yes
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

<!-- install packages -->
```{r echo=FALSE, include=FALSE}

   install.packages('dplyr', repos="http://cran.us.r-project.org")
   install.packages('knitr', repos="http://cran.us.r-project.org")
   install.packages('rvest', repos="http://cran.us.r-project.org")
   install.packages('ggplot2', repos="http://cran.us.r-project.org")
  install.packages('psych', repos="http://cran.us.r-project.org")
   install.packages('kableExtra')

```
      **libraries used**
      
        library(dplyr)
        library(knitr)
        library(rvest)
        library(ggplot2)
        library(psych)
      


## Load dataset into R.



```{r ReadFile}
#setwd("C:/SMU/doing_data_science/CaseStudy1/CaseStudy1")
#Read in the beers.csv and set to data frame
Beers <- read.csv("Beers.csv", header = TRUE, sep = ",")


#Read in the Breweries.csv and set to data frame
Breweries <- read.csv("Breweries.csv", header = TRUE, sep = ",")



```

##  Merge document and show top and bottom 6 rows


```{r merging}
#add equivalent name to Beers data frame for merge
Beers$Brew_ID <- Beers$Brewery_id


#Merge the data frames
dataset_merge <- merge(Breweries,Beers, by="Brew_ID",all=TRUE)

#Top 6 observations from merged file
Top6 <- head(dataset_merge,6)
Top6

#Bottome 6 observations from merged file
Bottom6 <- tail(dataset_merge)
Bottom6

```
## Rename columns to be more readable

```{r rename columns}
#Rename columns 
names(dataset_merge) <- c("Brew_ID","Company_Name","City","State","Beer_Name","Beer_ID","ABV","IBU", "Brew_ID","Beer_Style","OUnces")
Top10 <- head(dataset_merge)
Top10

```
## Show NA
```{r showNA}
#Get NA count from each column

ExamineNA <- function(column){
    
                  testNA <- sum(is.na(dataset_merge[column]))
                  
                  print (column)
                  print (testNA)
                }
  
  
 
for (x in names(dataset_merge)){ ExamineNA(x)}

```

## Breweries per state

```{r BreweriesPerState}
#find number of breweries in state
library(plyr)

BreweryState <- count(dataset_merge,"State")
BreweryState

```


```{r statesize}

#Plot of Breweries per State
library(ggplot2)

b1 <- ggplot(BreweryState, aes(x=reorder(BreweryState$State,-BreweryState$freq), y=BreweryState$freq, fill=BreweryState$State)) +
  
geom_bar(stat="identity") + labs(title ="Breweries in States", x= "States", y="Number of Breweries", fill="States") + theme(text = element_text(size=7),axis.text.x = element_text(angle=90, hjust=1))

b1

```

The median alcohol content and international bitterness units were calculated for each state and are shown in the tables and barplots below.    

```{r medians}
#Compute the median alcohol content and international bitterness unit for each state. Plot a bar chart to compare. 
library(psych)
library(kableExtra)
ABV_St <- describeBy(dataset_merge$ABV, dataset_merge$State, mat=T)
colnames(ABV_St)[colnames(ABV_St)=="group1"] <- "State"
IBU_St <- describeBy(dataset_merge$IBU, dataset_merge$State, mat=T)
colnames(IBU_St)[colnames(IBU_St)=="group1"] <- "State"
head(IBU_St)
ABV_St[,c(2,7)] %>%
  kable() %>%
  kable_styling()
IBU_St[,c(2,7)] %>%
  kable() %>%
  kable_styling()
```        


```{r Final}
#bar plot of Median Alcohol by volumne
ABV_plot <- ggplot(ABV_St, aes(x=ABV_St$State, y=ABV_St$median, fill=ABV_St$State)) +
  geom_bar(stat="identity") + labs(title ="Median Alcohol by Volume in States", x= "States", y="ABV", fill="States") + theme(text = element_text(size=9),axis.text.x = element_text(angle=90, hjust=1))

ABV_plot


#bar plot of Median IBU in states
IBU_plot <- ggplot(IBU_St, aes(x=IBU_St$State, y=IBU_St$median, fill=IBU_St$State)) +
  geom_bar(stat="identity") + labs(title ="Median Intl Bitterness in States", x= "States", y="IBU", fill="States") + theme(text = element_text(size=9),axis.text.x = element_text(angle=90, hjust=1))	

IBU_plot
```    

As shown graphically, Kentucky (KY) and Washington D.C. (DC) have breweries with the highest alcohol content (ABV) based on median values.     

Comparing the medians of IBU for each state, the most bitter beers are found in Maine.    
#A look into ABV/IBU    
Alcohol by Volume across all breweries ranges from 0.001 to 0.1280. The average ABV is 0.05977 which is slightly higher than the median of 0.056. This means that the average ABV level is pulled higher by some beers with higher alcohol content, but the concentration of ABV levels is close to being evenly scattered around the average. The first quartile is 0.05 and the third quartile is 0.067.    

```{r}
#Kentucky KY and DC show to be hightes  median ABV
summary(dataset_merge$ABV)
```    

The international bitterness units range from 4 to 138 across the beers. In this distribution there are more beers are concentrated towards the lower end of IBU levels. There are some very bitter beers that skew the average IBU level (42.71) to be higher than the median IBU value (35). The first quartile IBU is 21 and the third quartile is 64. 

```{r}
#max IBU shown to be Maine (ME)
summary(dataset_merge$IBU)
```    


```{r finalplots}

library(ggplot2)
#merge by group1 (states) for plot
ABV_IBU_merge <- merge(ABV_St,IBU_St, by="State",all=TRUE)


#scatter plot of ABV and IBU

med_scatter <- ggplot(ABV_IBU_merge, aes(x=ABV_IBU_merge$median.x, y=ABV_IBU_merge$median.y)) + geom_point(color="blue") + labs(title="Median Alcohol by Volume vs International Bitterness",x="Median Alcohol by Volume", y = "Median Intl Bitterness")+  theme_classic()  

med_scatter 

```     

There is a positive linear trend between IBU and ABV, meaning as alchol content increases, bitterness tends to increase as well. However, due to the fanning shape of the scatterplot, it appears that beers with lower alcohol content appear to have more similar bitterness levels than those with higher alchol. At higher ABV, there is more variation in bitterness levels. Beers can either have a low bitterness level or high level at the same alcohol content level, but on average, the bitterness tends to be higher than beers with lower ABV.     

```{r}

scatter2<- ggplot(dataset_merge[,-1], aes(x=dataset_merge$ABV, y=dataset_merge$IBU))+geom_point(color="blue")+labs(title="Alcohol by Volume vs International Bitterness",x="Alcohol by Volume", y = "Intl Bitterness")+  theme_classic()+ stat_ellipse() + geom_smooth(method=lm)

scatter2

#scatter w/ regression line
med_scat_reg <- ggplot(ABV_IBU_merge, aes(x=ABV_IBU_merge$median.x, y=ABV_IBU_merge$median.y)) + geom_point(color="blue") + labs(title="Median Alcohol by Volume vs International Bitterness",x="Median Alcohol by Volume", y = "Median Intl Bitterness")+   theme_classic() + stat_ellipse() + geom_smooth(method=lm)

med_scat_reg 

```    

This graph shows the both the median ABV and IBU values for each state. Particular states of interest are Utah and New Jersey, who have low median ABV levels compared to the clustered range of the other states. Likewise, Florida, Georgia, Maine, and West Virginia differ greatly from the other states and tend to have beers with higher bitterness levels.    

```{r}
#point bplot by state
med_plot_by_state <- ggplot(ABV_IBU_merge, aes(x = ABV_IBU_merge$State)) + 
  geom_point(aes(y = ABV_IBU_merge$median.x *1000), colour="blue") + 
  geom_point(aes(y = ABV_IBU_merge$median.y), colour = "red") + 
  ylab(label="Alcohol by volume and Intl Bitterness") + 
  xlab("States") + theme(text = element_text(size=9),axis.text.x = element_text(angle=90, hjust=1)) + ggtitle("Median Alcohol by volume(Blue) x 1000 and International Bitterness(Red) by State")

med_plot_by_state
sample<-sample.int(2410,250)
```    

For readability, a random sample of 250 beers were selected to invesigate the variance in differences between IBU and ABV. The variance in these differences are pretty high, since all the line segments are not the same length. This further supports the idea that bitterness levels are highly variable, and are only partially explained by alcohol content.    


```{r}
combined<-ggplot(dataset_merge[sample,-1], aes(x=Beer_ID))+
  geom_point(aes(y=dataset_merge[sample,7]*1000, colour="blue"), show.legend = FALSE)+
  geom_point(aes(y=dataset_merge[sample,8], colour="red"), show.legend = FALSE)+
  geom_segment(aes(x=dataset_merge[sample,6], y=dataset_merge[sample,7]*1000,xend=dataset_merge[sample,6], yend=dataset_merge[sample,8]))+ ylab(label="ABV and IBU")+
  xlab("Beer")+theme(text=element_text(size=9),axis.text.x = element_text(angle=90, hjust=1)) + ggtitle("Alcohol by volume(Red) x 1000 and International Bitterness(Blue)")+theme_classic()

combined
```    

In summary, brewers seem to be less experimental in terms of alcohol content than international bitterness units. More beers have lower alcohol content and lower bitterness, but there are a number of beers with more extreme bitterness and ABV levels.   

